              
           本文针对MySQL数据库服务器逐渐变慢的问题， 进行分析，并提出相应的解决办法。
    一、检查系统的状态

    通过操作系统的一些工具检查系统的状态，比如内存、交换、磁盘的利用率，根据经验或与系统正常时的状态相比对，有时系统表面上看起来看空闲，这也可能不是一个正常的状态，因为cpu可能正等待IO的完成。除此之外，还应观注那些占用系统资源内存的进程。

    1.使用sar来检查操作系统是否存在IO问题
sar 2 5 //每隔2秒，显示5次，CPU使用的情况
    　　%usr：CPU处在用户模式下的时间百分比。 　　%sys：CPU处在系统模式下的时间百分比。 　　%wio：CPU等待输入输出完成时间的百分比。 　　%idle：CPU空闲时间百分比。 

    在所有的显示中，我们应主要注意%wio和%idle，%wio的值过高，表示硬盘存在I/O瓶颈， %idle值高，表示CPU较空闲，如果%idle值高但系统响应慢时，有可能是CPU等待分配内存， 此时应加大内存容量。%idle值如果持续低于10，那么系统的CPU处理能力相对较低，表 明系统中最需要解决的资源是CPU。 

    　　　　sar 1 10 > data.txt //每隔1秒，写入10次，把CPU使用数据保存到data.txt文件中。 sar 1 0 -e 15:00:00 > data.txt //每隔1秒记录CPU的使用情况，直到15点，数据将保存到data.txt文件中。(-e 参数表示结束时间，注意时间格式：必须为hh:mm:ss格式) sar 1 0 -r -e 15:00:00 > data.txt //每隔1秒记录内存使用情况，直到15点，数据将保存到data.txt文件中。 sar 1 0 -n DEV -e 15:00:00 > data.txt //每隔1秒记录网络使用情况，直到15点，数据将保存到data.txt文件中。 

    

    　　　　例二：使用命行sar -v t n 

    例如，每30秒采样一次，连续采样5次，观察核心表的状态，需键入如下命令： 

    # sar -v 30 5 

    屏幕显示： 　　　　　　SCO_SV scosysv 3.2v5.0.5 i80386 10/01/2001 　　　　　　10:33:23 proc-sz ov inod-sz ov file-sz ov lock-sz　　 (-v) 10:33:53　305/　321 　0　1337/2764　 0　1561/1706　0　40/　128 10:34:23　308/　321 　0　1340/2764　 0　1587/1706　0　37/　128 10:34:53　305/　321 　0　1332/2764　 0　1565/1706　0　36/　128 10:35:23　308/　321 　0　1338/2764　 0　1592/1706　0　37/　128 10:35:53　308/　321　 0　1335/2764　 0　1591/1706　0　37/　128 

    显示内容包括： 

    proc-sz：目前核心中正在使用或分配的进程表的表项数，由核心参数MAX-PROC控制。 

    　　inod-sz：目前核心中正在使用或分配的i节点表的表项数，由核心参数 MAX-INODE控制。 

    　　file-sz： 目前核心中正在使用或分配的文件表的表项数，由核心参数MAX-FILE控 制。 

    　　ov：溢出出现的次数。 

    　　Lock-sz：目前核心中正在使用或分配的记录加锁的表项数，由核心参数MAX-FLCKRE 控制。 

    显示格式为 

    实际使用表项/可以使用的表项数 

    显示内容表示，核心使用完全正常，三个表没有出现溢出现象，核心参数不需调整，如 果出现溢出时，要调整相应的核心参数，将对应的表项数加大。 

    例三：使用命行sar -d t n 

    例如，每30秒采样一次，连续采样5次，报告设备使用情况，需键入如下命令： 

    # sar -d 30 5 

    屏幕显示： 

    　　　　　　SCO_SV scosysv 3.2v5.0.5 i80386 10/01/2001 11:06:43 device　%busy　　　avque　　　r+w/s　　blks/s　　avwait avserv (-d) 11:07:13 wd-0　　　1.47　　　2.75　　　4.67　　　14.73　　 5.50 3.14 11:07:43 wd-0　　　0.43　　　18.77　　 3.07　　　8.66　　　25.11 1.41 11:08:13 wd-0　　　0.77　　　2.78　　　2.77　　　7.26　　　4.94 2.77 11:08:43 wd-0　　　1.10　　　11.18　　 4.10　　　11.26　　 27.32 2.68 11:09:13 wd-0　　　1.97　　　21.78　　 5.86　　　34.06　　　69.66 3.35 Average wd-0　　　1.15　　　12.11　　 4.09　　　15.19　　　31.12 2.80 

    显示内容包括： 

    device： sar命令正在监视的块设备的名字。 　　%busy： 设备忙时，传送请求所占时间的百分比。 　　avque： 队列站满时，未完成请求数量的平均值。 　　r+w/s： 每秒传送到设备或从设备传出的数据量。 　　blks/s： 每秒传送的块数，每块512字节。 　　avwait： 队列占满时传送请求等待队列空闲的平均时间。 　　avserv： 完成传送请求所需平均时间（毫秒）。 

    在显示的内容中，wd-0是硬盘的名字，%busy的值比较小，说明用于处理传送请求的有 效时间太少，文件系统效率不高，一般来讲，%busy值高些，avque值低些，文件系统 的效率比较高，如果%busy和avque值相对比较高，说明硬盘传输速度太慢，需调整。 

    例四：使用命行sar -b t n 

    例如，每30秒采样一次，连续采样5次，报告缓冲区的使用情况，需键入如下命令： 

    # sar -b 30 5 

    屏幕显示： 

    　　SCO_SV scosysv 3.2v5.0.5 i80386 10/01/2001 14:54:59 bread/s lread/s %rcache bwrit/s lwrit/s %wcache pread/s pwrit/s (-b) 14:55:29　0　　147　　100　 5　　21　　78　　 0　　　0 14:55:59　0　　186　　100　 5　　25　　79　　 0　　　0 14:56:29　4　　232 　　98　 8　　58　　86　　 0　　　0 14:56:59　0　　125　　100　 5　　23　　76　　 0　　　0 14:57:29　0　　 89　　100　 4　　12　　66　　 0　　　0 Average　 1　　156 　　99　 5　　28　　80　　 0　　　0 

    显示内容包括： 

    bread/s： 每秒从硬盘读入系统缓冲区buffer的物理块数。 lread/s： 平均每秒从系统buffer读出的逻辑块数。 %rcache： 在buffer cache中进行逻辑读的百分比。 bwrit/s： 平均每秒从系统buffer向磁盘所写的物理块数。 lwrit/s： 平均每秒写到系统buffer逻辑块数。 %wcache： 在buffer cache中进行逻辑读的百分比。 pread/s： 平均每秒请求物理读的次数。 pwrit/s： 平均每秒请求物理写的次数。 

    在显示的内容中，最重要的是%cache和%wcache两列，它们的值体现着buffer的使用效 率，%rcache的值小于90或者%wcache的值低于65，应适当增加系统buffer的数量，buffer 数量由核心参数NBUF控制，使%rcache达到90左右，%wcache达到80左右。但buffer参数 值的多少影响I/O效率，增加buffer，应在较大内存的情况下，否则系统效率反而得不到 提高。 

    例五：使用命行sar -g t n 

    例如，每30秒采样一次，连续采样5次，报告串口I/O的操作情况，需键入如下命令： 

    # sar -g 30 5 

    屏幕显示： 

    SCO_SV scosysv 3.2v5.0.5 i80386　　11/22/2001 17:07:03 　ovsiohw/s　 ovsiodma/s　　ovclist/s (-g) 17:07:33　　　0.00　　　0.00　　　0.00 17:08:03　　　0.00　　　0.00　　　0.00 17:08:33　　　0.00　　　0.00　　　0.00 17:09:03　　　0.00　　　0.00　　　0.00 17:09:33　　　0.00　　　0.00　　　0.00 Average 　　　0.00　　　0.00　　　0.00 

    显示内容包括： 

    ovsiohw/s：每秒在串口I/O硬件出现的溢出。 

    ovsiodma/s：每秒在串口I/O的直接输入输出通道高速缓存出现的溢出。 

    ovclist/s ：每秒字符队列出现的溢出。 

    在显示的内容中，每一列的值都是零，表明在采样时间内，系统中没有发生串口I/O溢 出现象。

    2.使用vmstat监控内存 cpu资源

[root@mysql1 ~]# vmstatprocs ―――Cmemory―――-―swapC ―Cio―-CsystemC ―Ccpu――rb swpd free buffcache si sobiboin cs us sy id wa st007225428547126722640014435359119800


    vmstat 的输出那些信息值得关注?

    io bo: 磁盘写的数据量稍大，如果是大文件的写，10M以内基本不用担心，如果是小文件写2M以内基本正常

    ① CPU问题

    下面几列需要被察看，以确定cpu是否有问题

Processesinthe run queue (procs r)Usertime (cpu us)System time (cpu sy)Idle time (cpu id)


    问题情况:

    如果processes in run queue (procs r)的数量远大于系统中cpu的数量，将会使系统便慢。

    如果这个数量是cpu的4倍的话，说明系统正面临cpu能力短缺,这将使系统运行速度大幅度降低

    如果cpu的idle时间经常为0的话，或者系统占用时间(cpu sy)是用户占用时间(cpu us)两辈的话，系统面临缺少cpu资源

    解决方案 :

    解决这些情况，涉及到调整应用程序，使其能更有效的使用cpu，同时增加cpu的能力或数量

    ②内存问题

    主要查看页导入的数值(swap中的si)，如果该值比较大就要考虑内存，大概方法如下：

    最简单的，加大RAM

    减少RAM的需求

    3.磁盘IO问题

    处理方式：做raid10提高性能

    4.网络问题

    telnet一下MySQL对外开放的端口，如果不通的话，看看防火墙是否正确设置了。另外，看看MySQL是不是开启了skip-networking的选项，如果开启请关闭。
              
    
      
来自:http://www.i5good.com/2011121426.html